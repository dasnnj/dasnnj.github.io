<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/icon.jpeg"><link rel="icon" type="image/png" sizes="32x32" href="/images/icon.jpeg"><link rel="icon" type="image/png" sizes="16x16" href="/images/icon.jpeg"><link rel="mask-icon" href="/icon.jpeg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"dasnnj.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":800},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="分组查询，且只取每一组内的一条最新的记录需求：查询 code 为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）12345678910select * from (select code    col1,    col2,    row_number() over (partition by code order by time desc) rank    from t_"><meta property="og:type" content="article"><meta property="og:title" content="Oracle分组查询"><meta property="og:url" content="https://dasnnj.github.io/2019/04/06-7f5dbfc8a6a6/index.html"><meta property="og:site_name" content="life is love"><meta property="og:description" content="分组查询，且只取每一组内的一条最新的记录需求：查询 code 为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）12345678910select * from (select code    col1,    col2,    row_number() over (partition by code order by time desc) rank    from t_"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-04-06T03:15:13.000Z"><meta property="article:modified_time" content="2019-04-06T03:22:01.000Z"><meta property="article:author" content="Jayce"><meta property="article:tag" content="oracle"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://dasnnj.github.io/2019/04/06-7f5dbfc8a6a6/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dasnnj.github.io/2019/04/06-7f5dbfc8a6a6/","path":"2019/04/06-7f5dbfc8a6a6/","title":"Oracle分组查询"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Oracle分组查询 | life is love</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">life is love</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">记录生活和学习</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%EF%BC%8C%E4%B8%94%E5%8F%AA%E5%8F%96%E6%AF%8F%E4%B8%80%E7%BB%84%E5%86%85%E7%9A%84%E4%B8%80%E6%9D%A1%E6%9C%80%E6%96%B0%E7%9A%84%E8%AE%B0%E5%BD%95"><span class="nav-text">分组查询，且只取每一组内的一条最新的记录</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E6%9F%A5%E8%AF%A2-code-%E4%B8%BAa%EF%BC%8Cb%EF%BC%8Cc%E4%B8%94%E5%9C%A8%E6%9C%89%E6%95%88%E6%97%B6%E9%97%B4%E6%AE%B5%E5%86%85%E7%9A%84%E6%AF%8F%E4%B8%AAcode%E6%9C%80%E6%96%B0%E7%9A%84%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%EF%BC%88code%E4%B8%8D%E6%98%AF%E4%B8%BB%E9%94%AE%EF%BC%89"><span class="nav-text">需求：查询 code 为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Jayce" src="/images/icon.jpeg"><p class="site-author-name" itemprop="name">Jayce</p><div class="site-description" itemprop="description">Nothing is impossible, the word itself says I'm possible.</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="mailto:dasnnj@outlook.com" title="E-Mail → mailto:dasnnj@outlook.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://dasnnj.github.io/2019/04/06-7f5dbfc8a6a6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/icon.jpeg"><meta itemprop="name" content="Jayce"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="life is love"><meta itemprop="description" content="Nothing is impossible, the word itself says I'm possible."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Oracle分组查询 | life is love"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Oracle分组查询</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-04-06 11:15:13 / 修改时间：11:22:01" itemprop="dateCreated datePublished" datetime="2019-04-06T11:15:13+08:00">2019-04-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/Oracle/" itemprop="url" rel="index"><span itemprop="name">Oracle</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h3 id="分组查询，且只取每一组内的一条最新的记录"><a href="#分组查询，且只取每一组内的一条最新的记录" class="headerlink" title="分组查询，且只取每一组内的一条最新的记录"></a>分组查询，且只取每一组内的一条最新的记录</h3><h5 id="需求：查询-code-为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）"><a href="#需求：查询-code-为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）" class="headerlink" title="需求：查询 code 为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）"></a>需求：查询 code 为a，b，c且在有效时间段内的每个code最新的一条记录（code不是主键）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> code</span><br><span class="line">    col1,</span><br><span class="line">    col2,</span><br><span class="line">    <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> code <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">time</span> <span class="keyword">desc</span>) rank</span><br><span class="line">    <span class="keyword">from</span> t_order</span><br><span class="line">    <span class="keyword">where</span> type<span class="operator">=</span> <span class="string">&#x27;107&#x27;</span></span><br><span class="line">    <span class="keyword">and</span> to_char(sysdate, <span class="string">&#x27;yyyymmdd-hh24:mi:ss&#x27;</span>) <span class="operator">&amp;</span>lt;<span class="operator">=</span> validuntilTime</span><br><span class="line">        <span class="keyword">and</span> code <span class="keyword">in</span></span><br><span class="line">    (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    ) <span class="keyword">where</span> rank <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><span id="more"></span><ul><li>其中下面代码含义是将时间在有效时间段内（<code>to_char(sysdate, &#39;yyyymmdd-hh24:mi:ss&#39;) &amp;lt;= validuntilTime</code>）且code为a，或b，或c（<code>code in(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;)</code>）的所有记录根据code分组(<code>partition by code</code>），且组内的顺序是根据时间的逆序排列（<code>order by time desc</code>）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> code</span><br><span class="line">    col1,</span><br><span class="line">    col2,</span><br><span class="line">    <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> code <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">time</span> <span class="keyword">desc</span>) rank</span><br><span class="line">    <span class="keyword">from</span> t_order</span><br><span class="line">    <span class="keyword">where</span> type<span class="operator">=</span> <span class="string">&#x27;107&#x27;</span></span><br><span class="line">    <span class="keyword">and</span> to_char(sysdate, <span class="string">&#x27;yyyymmdd-hh24:mi:ss&#x27;</span>) <span class="operator">&amp;</span>lt;<span class="operator">=</span> validuntilTime</span><br><span class="line">        <span class="keyword">and</span> code <span class="keyword">in</span></span><br><span class="line">    (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    ) </span><br></pre></td></tr></table></figure><ul><li>上面执行结果是类似下面表格效果</li></ul><table><thead><tr><th>CODE</th><th>COL1</th><th>COL2</th><th>RANK</th></tr></thead><tbody><tr><td>a</td><td>xxx</td><td>xxx</td><td>1</td></tr><tr><td>a</td><td>xxx</td><td>xxx</td><td>2</td></tr><tr><td>a</td><td>xxx</td><td>xxx</td><td>3</td></tr><tr><td>b</td><td>xxx</td><td>xxx</td><td>1</td></tr><tr><td>b</td><td>xxx</td><td>xxx</td><td>2</td></tr><tr><td>c</td><td>xxx</td><td>xxx</td><td>1</td></tr><tr><td>c</td><td>xxx</td><td>xxx</td><td>2</td></tr><tr><td>c</td><td>xxx</td><td>xxx</td><td>3</td></tr><tr><td>c</td><td>xxx</td><td>xxx</td><td>4</td></tr></tbody></table><ul><li>然后将其作为子查询，在外层套一个<code>select * from (上面的代码) where rank = 1</code>就能将每一组内的一条最新的记录查询出来了</li></ul></div><footer class="post-footer"><div class="reward-container"><div>请我一杯咖啡吧！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/images/wechatpay.png" alt="Jayce 微信"> <span>微信</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Jayce</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://dasnnj.github.io/2019/04/06-7f5dbfc8a6a6/" title="Oracle分组查询">https://dasnnj.github.io/2019/04/06-7f5dbfc8a6a6/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/oracle/" rel="tag"><i class="fa fa-tag"></i> oracle</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2019/04/19-50daf3b41aac/" rel="prev" title="SVN Update Error 解决方案"><i class="fa fa-angle-left"></i> SVN Update Error 解决方案</a></div><div class="post-nav-item"> <a href="/2019/02/24-ea04fe16a571/" rel="next" title="hexo之nexT主题优化配置">hexo之nexT主题优化配置<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Jayce</span></div></div></footer><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/dasnnj" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"dasnnj","repo":"comments_of_note","client_id":"997c7437261c89df9fde","client_secret":"5d4ba7ff0c7693537b2aeaa6736ba9a032d8267f","admin_user":"dasnnj","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"5a9fe00b895ebe4a93a2993e0301742d"}</script><script src="/js/third-party/comments/gitalk.js"></script></body></html>